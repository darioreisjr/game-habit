# ğŸš€ Game Habit - VersÃ£o 3.0

## ğŸ“‹ Resumo

A VersÃ£o 3 do Game Habit adiciona funcionalidades sociais e multiplayer completas, transformando o app em uma experiÃªncia verdadeiramente social e competitiva.

## âœ¨ Novidades Principais

### 1. Sistema de Amigos ğŸ‘¥
- **Busca de UsuÃ¡rios**: Encontre jogadores por username ou cÃ³digo de amigo Ãºnico
- **SolicitaÃ§Ãµes**: Sistema completo de convites aceitar/recusar
- **Feed Social**: Veja as conquistas e atividades dos seus amigos
- **Mensagens**: Chat direto entre amigos
- **Perfis PÃºblicos**: Perfil customizÃ¡vel com bio e avatar

### 2. Rankings Globais ğŸ†
- **Rankings MÃºltiplos**: Semanal, Mensal, Global e Entre Amigos
- **Top 100**: Veja os melhores jogadores
- **AtualizaÃ§Ã£o AutomÃ¡tica**: Rankings recalculados periodicamente
- **PosiÃ§Ã£o Pessoal**: Veja sua posiÃ§Ã£o em tempo real

### 3. Desafios Multiplayer ğŸ®
- **3 Modos de Jogo**:
  - **Co-op**: Trabalhe junto com amigos
  - **Competitivo**: Compita diretamente
  - **Team vs Team**: Times competindo
- **4 Tipos de Batalha**:
  - Speed Run (mais rÃ¡pido)
  - Total Habits (quem completa mais)
  - Streak Battle (batalha de streaks)
  - Boss Raid (desafio cooperativo contra chefe)
- **Sistema de Convites**: CÃ³digos privados para desafios entre amigos
- **Chat em Tempo Real**: Converse durante o desafio
- **Recompensas**: DistribuiÃ§Ã£o automÃ¡tica baseada em ranking

### 4. Power-ups Expandidos ğŸ’ª
**Novos Items (20+):**
- ğŸ„ **Mega Mushroom** - 3x XP por 6h (150 moedas)
- ğŸŒ» **Gold Flower** - Converte XP em moedas dobradas (200)
- ğŸš **Blue Shell** - 500 XP instantÃ¢neo (100)
- ğŸƒ **Super Leaf** - Completa 3 hÃ¡bitos retroativos (250)
- ğŸª¶ **Cape Feather** - Pula 1 dia de falha (180)
- ğŸª™ **Lucky Coin** - 50% chance dobrar XP (120)
- â­ **Rainbow Star** - Duplica todos multiplicadores (300)
- ğŸ›¡ï¸ **Shield Block** - ProteÃ§Ã£o de 7 dias (350)
- ğŸš© **Checkpoint Flag** - Salva e restaura progresso (400)
- ğŸ† **Golden Mushroom** - XP infinito por 1h (500)

**Novos Temas:**
- ğŸŒŒ Galaxy (tema espacial) - 500 moedas
- ğŸŒƒ Neon City (cyberpunk) - 500 moedas
- ğŸŒ² Forest (floresta) - 500 moedas

**CosmÃ©ticos:**
- ğŸ‘‘ Crown (coroa dourada) - 1000 moedas
- ğŸ… Champion Badge - 800 moedas
- ğŸŒˆ Rainbow Trail - 600 moedas
- ğŸ† Fireworks - 400 moedas

**Sistema de Combos:**
- Combine itens ativos para bÃ´nus especiais
- Ex: Super Mushroom + Star = 5x XP por 4h + 1000 XP bÃ´nus

### 5. EstatÃ­sticas AvanÃ§adas ğŸ“Š
- **Dashboard Completo**: Visualize hoje, semana e mÃªs
- **AnÃ¡lise por HÃ¡bito**: Score de consistÃªncia individual
- **Insights por IA**: RecomendaÃ§Ãµes personalizadas automÃ¡ticas
- **Metas CustomizÃ¡veis**: Crie suas prÃ³prias metas
- **Benchmarking**: Compare-se com mÃ©dias da plataforma
- **PrevisÃµes**: Estimativas baseadas em padrÃµes

**Tipos de Insights:**
- ğŸ¯ Conquista prÃ³xima
- âš¡ Aviso de streak
- ğŸ‘ Elogio de consistÃªncia
- ğŸ’¡ SugestÃ£o de melhoria
- â° Melhor horÃ¡rio para hÃ¡bitos
- ğŸ“Š Balanceamento de Ã¡reas

### 6. IntegraÃ§Ã£o com Wearables âŒš
**Dispositivos Suportados:**
- Google Fit
- Apple Health
- Fitbit
- Garmin
- Samsung Health
- Mi Fit
- Strava
- Whoop

**Dados Sincronizados:**
- ğŸš¶ Passos
- ğŸ“ DistÃ¢ncia
- ğŸ”¥ Calorias
- â¤ï¸ FrequÃªncia cardÃ­aca
- ğŸ˜´ Sono
- â±ï¸ Minutos ativos
- ğŸ‹ï¸ Treinos
- âš–ï¸ Peso
- ğŸ’§ Ãgua
- ğŸ§˜ MeditaÃ§Ã£o

**Funcionalidades:**
- **Auto-completar HÃ¡bitos**: Configure metas (ex: 10.000 passos = hÃ¡bito completo)
- **Conquistas Fitness**: 13 conquistas exclusivas
- **Metas Fitness**: Objetivos automÃ¡ticos baseados em dados
- **SincronizaÃ§Ã£o AutomÃ¡tica**: A cada 60 minutos (configurÃ¡vel)

### 7. Sistema de Pets ğŸ¾
**15+ Pets DisponÃ­veis:**
- ğŸ¦– Yoshi (Verde, Vermelho, Azul, Amarelo)
- ğŸ‘» Boo (Branco, King Boo)
- ğŸ¢ Koopa (Verde, Vermelho, Paratroopa)
- ğŸ„ Toad (Vermelho, Azul, Toadette)
- â›“ï¸ Chain Chomp
- â˜ï¸ Lakitu
- ğŸ­ Shy Guy

**Sistema Completo:**
- **Stats**: Felicidade, Fome, Energia
- **InteraÃ§Ãµes**: Alimentar, Brincar, Carinho, Dormir, Treinar
- **NÃ­veis**: Pet sobe de nÃ­vel com vocÃª
- **Comidas**: 7+ comidas diferentes com efeitos
- **AcessÃ³rios**: ChapÃ©us, Ã³culos, asas, etc
- **Aventuras**: 4 aventuras de 30min a 3h
- **Recompensas**: Moedas, XP e itens raros

**Pet Ativo:**
- Apenas 1 pet ativo por vez
- Pet ganha 10% do seu XP
- Pet fica feliz quando vocÃª completa hÃ¡bitos
- Stats degradam com o tempo (precisa cuidar!)

## ğŸ—„ï¸ Estrutura do Banco de Dados

### Principais FunÃ§Ãµes SQL Adicionadas

#### Amigos e Social
```sql
get_friends(user_id) -- Retorna lista de amigos
search_users(term) -- Busca usuÃ¡rios
generate_friend_code() -- Gera cÃ³digo Ãºnico
```

#### Rankings
```sql
update_global_leaderboard() -- Atualiza ranking
update_challenge_rankings(challenge_id) -- Ranking de desafio
```

#### Multiplayer
```sql
accept_challenge_invite(invite_id) -- Aceita convite
distribute_challenge_rewards(challenge_id) -- Distribui prÃªmios
update_multiplayer_score_on_checkin() -- Atualiza score (trigger)
```

#### Items e Power-ups
```sql
use_consumable_item(item_key, context) -- Usa item
calculate_xp_with_boosts(base_xp, user_id) -- Calcula XP com boosts
cleanup_expired_effects() -- Limpa efeitos expirados
```

#### EstatÃ­sticas
```sql
get_user_dashboard(user_id) -- Dashboard completo
update_daily_statistics(date, user_id) -- Atualiza stats diÃ¡rias
calculate_habit_consistency(habit_id, days) -- Score de consistÃªncia
generate_user_insights(user_id) -- Gera insights automÃ¡ticos
```

#### Wearables
```sql
process_wearable_data_for_habits() -- Completa hÃ¡bitos (trigger)
check_fitness_achievements() -- Verifica conquistas (trigger)
get_daily_fitness_summary(user_id, date) -- Resumo do dia
```

#### Pets
```sql
interact_with_pet(pet_id, interaction, item) -- Interage com pet
give_pet_xp_on_checkin() -- Pet ganha XP (trigger)
degrade_pet_stats() -- Degrada stats com tempo
```

## ğŸ¨ Componentes de Interface

### PÃ¡ginas Novas (V3)
- `/friends` - Sistema de amigos
- `/leaderboard` - Rankings globais
- `/pets` - Gerenciamento de pets
- `/stats` - EstatÃ­sticas avanÃ§adas

### Componentes Criados
- `FriendsPage` - Lista e busca de amigos
- `LeaderboardPage` - Rankings com filtros
- `PetsPage` - Interface completa de pets
- `StatsPage` - Dashboard de estatÃ­sticas

## ğŸ”§ ConfiguraÃ§Ã£o

### 1. Executar Migrations
Execute todas as 6 novas migrations na ordem:
```sql
20240106000000_v3_friends_ranking.sql
20240107000000_v3_multiplayer_challenges.sql
20240108000000_v3_new_powerups_items.sql
20240109000000_v3_advanced_statistics.sql
20240110000000_v3_wearables_integration.sql
20240111000000_v3_pets_system.sql
```

### 2. Configurar Cron Jobs (Opcional)
Para funcionalidades automÃ¡ticas, configure jobs periÃ³dicos:

```sql
-- Atualizar rankings (a cada hora)
SELECT cron.schedule('update-leaderboards', '0 * * * *', $$
  SELECT update_global_leaderboard();
$$);

-- Limpar efeitos expirados (a cada 6 horas)
SELECT cron.schedule('cleanup-effects', '0 */6 * * *', $$
  SELECT cleanup_expired_effects();
$$);

-- Degradar stats dos pets (a cada 12 horas)
SELECT cron.schedule('degrade-pets', '0 */12 * * *', $$
  SELECT degrade_pet_stats();
$$);

-- Gerar insights diÃ¡rios (todo dia Ã s 6h)
SELECT cron.schedule('generate-insights', '0 6 * * *', $$
  SELECT generate_user_insights(user_id) FROM auth.users;
$$);
```

### 3. Configurar Wearables (Opcional)
Para integraÃ§Ã£o com wearables, vocÃª precisarÃ¡:
1. Criar apps nos consoles de cada plataforma (Google Fit, etc)
2. Obter credenciais OAuth
3. Configurar tokens no Supabase (criptografados)
4. Implementar sincronizaÃ§Ã£o via API

## ğŸ® Novas Rotas da API

### Amigos
- `GET /api/friends` - Lista amigos
- `POST /api/friends/request` - Envia convite
- `PUT /api/friends/respond` - Aceita/recusa
- `GET /api/friends/search?q=term` - Busca usuÃ¡rios

### Rankings
- `GET /api/leaderboard?period=weekly` - Ranking
- `GET /api/leaderboard/rank` - Sua posiÃ§Ã£o

### Multiplayer
- `POST /api/challenges/multiplayer` - Cria desafio
- `POST /api/challenges/join` - Entra em desafio
- `GET /api/challenges/:id/chat` - Mensagens

### Pets
- `POST /api/pets/adopt` - Adota pet
- `POST /api/pets/interact` - Interage
- `POST /api/pets/adventure` - Inicia aventura

### Stats
- `GET /api/stats/dashboard` - Dashboard completo
- `GET /api/stats/insights` - Insights personalizados

## ğŸ” SeguranÃ§a

Todas as tabelas da V3 tÃªm:
- âœ… Row Level Security (RLS) habilitado
- âœ… PolÃ­ticas de acesso por usuÃ¡rio
- âœ… ValidaÃ§Ãµes de constraints
- âœ… Triggers para integridade

## ğŸ“ˆ Performance

### Ãndices Criados
Foram criados 80+ Ã­ndices para otimizar queries:
- Ãndices em user_id para todas as tabelas
- Ãndices compostos para queries comuns
- Ãndices em timestamps para ordenaÃ§Ã£o
- Ãndices em status/flags para filtragem

### OtimizaÃ§Ãµes
- Uso de `JSONB` para dados flexÃ­veis
- FunÃ§Ãµes com `SECURITY DEFINER` quando necessÃ¡rio
- Triggers otimizados (apenas quando mudanÃ§a relevante)
- PaginaÃ§Ã£o via `LIMIT/OFFSET`

## ğŸ› Troubleshooting

### Rankings nÃ£o atualizam
Execute manualmente:
```sql
SELECT update_global_leaderboard();
```

### Wearables nÃ£o sincronizam
Verifique:
1. Token de acesso nÃ£o expirado
2. PermissÃµes concedidas no dispositivo
3. Ãšltima sincronizaÃ§Ã£o (`last_sync`)

### Pet stats nÃ£o degradam
Execute manualmente:
```sql
SELECT degrade_pet_stats();
```

### Insights nÃ£o aparecem
Gere manualmente:
```sql
SELECT generate_user_insights(auth.uid());
```

## ğŸ¯ PrÃ³ximos Passos

1. Testar todas as funcionalidades
2. Popular dados iniciais (pets, items, achievements)
3. Configurar cron jobs
4. Implementar sincronizaÃ§Ã£o wearables
5. Adicionar analytics para tracking

## ğŸ“ Notas Importantes

- Todos os dados sÃ£o salvos **automaticamente** no Supabase
- Triggers garantem **integridade** entre tabelas
- Sistema Ã© **extensÃ­vel** para V4
- CÃ³digo estÃ¡ **documentado** com comments SQL
- **100% TypeScript** com tipos gerados

---

**Desenvolvido com â¤ï¸ para a comunidade Game Habit**
